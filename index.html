<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .task-card {
            transition: all 0.3s ease;
        }
        .task-card:hover {
            transform: translateY(-5px);
        }
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            height: 20px;
            width: 20px;
            background-color: #ef4444;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
        }
        .excel-table {
            border-collapse: collapse;
        }
        .excel-table th, .excel-table td {
            border: 1px solid #e5e7eb;
            padding: 8px;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="loginSection" class="min-h-screen flex items-center justify-center">
        <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Task Management System</h2>
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-gray-700">Email</label>
                    <input type="email" id="email" class="w-full p-2 border rounded" required>
                </div>
                <div>
                    <label class="block text-gray-700">Password</label>
                    <input type="password" id="password" class="w-full p-2 border rounded" required>
                </div>
                <button type="submit" class="w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Login</button>
            </form>
        </div>
    </div>

    <div id="adminDashboard" class="hidden">
        <nav class="bg-blue-600 text-white p-4">
            <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-xl font-bold">Admin Dashboard</h1>
                <div class="flex space-x-4 mt-2 md:mt-0">
                    <button onclick="showAdminSection('taskManagement')" class="bg-blue-700 px-3 py-1 rounded hover:bg-blue-800">Task Management</button>
                    <button onclick="showAdminSection('employeeList')" class="bg-blue-700 px-3 py-1 rounded hover:bg-blue-800">Employees</button>
                    <button onclick="showAdminSection('emailScraper')" class="bg-blue-700 px-3 py-1 rounded hover:bg-blue-800">Email Scraper</button>
                    <div class="relative">
                        <button onclick="toggleNotifications()" class="bg-blue-700 px-3 py-1 rounded hover:bg-blue-800">
                            <i class="bi bi-bell"></i>
                            <span id="notificationBadge" class="notification-badge hidden">0</span>
                        </button>
                        <div id="notificationsDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-10">
                            <div class="p-3 border-b">
                                <h3 class="text-gray-700 font-semibold">Notifications</h3>
                            </div>
                            <div id="notificationsList" class="max-h-64 overflow-y-auto p-2">
                                <!-- Notifications will be added here -->
                                <p class="text-gray-500 text-sm p-2">No new notifications</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="logout()" class="bg-red-500 px-4 py-1 rounded hover:bg-red-600">Logout</button>
                </div>
            </div>
        </nav>

        <div id="taskManagementSection" class="container mx-auto p-6">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-bold mb-4">Assign New Task</h2>
                    <form id="taskForm" class="space-y-4">
                        <div>
                            <label class="block text-gray-700">Employee</label>
                            <select id="employee" class="w-full p-2 border rounded" required>
                                <option value="">Select an employee</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700">Task Title</label>
                            <input type="text" id="taskTitle" class="w-full p-2 border rounded" required>
                        </div>
                        <div>
                            <label class="block text-gray-700">Task Description</label>
                            <textarea id="taskDesc" class="w-full p-2 border rounded" rows="3" required></textarea>
                        </div>
                        <div>
                            <label class="block text-gray-700">Hours Allocation</label>
                            <input type="number" id="hours" class="w-full p-2 border rounded" min="1" required>
                        </div>
                        <div>
                            <label class="block text-gray-700">Deadline</label>
                            <input type="datetime-local" id="deadline" class="w-full p-2 border rounded" required>
                        </div>
                        <div>
                            <label class="block text-gray-700">Frequency</label>
                            <select id="frequency" class="w-full p-2 border rounded">
                                <option value="once">Once</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monday">Every Monday</option>
                                <option value="tuesday">Every Tuesday</option>
                                <option value="wednesday">Every Wednesday</option>
                                <option value="thursday">Every Thursday</option>
                                <option value="friday">Every Friday</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700">Priority</label>
                            <select id="priority" class="w-full p-2 border rounded">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" id="sendReminder" class="mr-2">
                            <label for="sendReminder" class="text-gray-700">Send reminder</label>
                        </div>
                        <button type="submit" class="w-full bg-green-500 text-white p-2 rounded hover:bg-green-600">
                            Assign Task
                        </button>
                    </form>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Task Overview</h2>
                        <div class="flex space-x-2">
                            <select id="statusFilter" class="p-2 border rounded text-sm">
                                <option value="all">All</option>
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                                <option value="overdue">Overdue</option>
                            </select>
                            <select id="employeeFilter" class="p-2 border rounded text-sm">
                                <option value="all">All Employees</option>
                            </select>
                        </div>
                    </div>
                    <div id="taskList" class="space-y-4 max-h-[600px] overflow-y-auto">
                        <!-- Tasks will be dynamically added here -->
                        <p class="text-center text-gray-500 p-4">No tasks yet</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="employeeListSection" class="container mx-auto p-6 hidden">
            <div class="bg-white p-6 rounded-lg shadow">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Employee Management</h2>
                    <button onclick="toggleAddEmployeeForm()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        <i class="bi bi-plus"></i> Add New Employee
                    </button>
                </div>
                
                <div id="addEmployeeForm" class="mb-6 hidden bg-gray-50 p-4 rounded">
                    <h3 class="font-semibold mb-2">Add New Employee</h3>
                    <form id="newEmployeeForm" class="space-y-3">
                        <input type="hidden" id="editingEmpId" value="">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm">Full Name</label>
                                <input type="text" id="empName" class="w-full p-2 border rounded" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm">Email</label>
                                <input type="email" id="empEmail" class="w-full p-2 border rounded" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm">Password</label>
                                <input type="password" id="empPassword" class="w-full p-2 border rounded" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm">Position</label>
                                <input type="text" id="empPosition" class="w-full p-2 border rounded" required>
                            </div>
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button type="button" onclick="toggleAddEmployeeForm()" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
                            <button type="submit" id="saveEmployeeBtn" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Add Employee</button>
                        </div>
                    </form>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full excel-table">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="text-left py-3 px-4">Name</th>
                                <th class="text-left py-3 px-4">Email</th>
                                <th class="text-left py-3 px-4">Position</th>
                                <th class="text-left py-3 px-4">Tasks</th>
                                <th class="text-left py-3 px-4">Completion Rate</th>
                                <th class="text-left py-3 px-4">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="employeeTableBody">
                            <!-- Employee list will be dynamically added here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="emailScraperSection" class="container mx-auto p-6 hidden">
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-4">Email Scraper Tool</h2>
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Upload Excel File</h3>
                    <p class="text-sm text-gray-500 mb-3">Upload an Excel file containing URLs to LinkedIn profiles or webpages to extract emails.</p>
                    <div class="flex items-center space-x-2">
                        <label for="excelFile" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 cursor-pointer">
                            <i class="bi bi-upload"></i> Upload Excel
                        </label>
                        <input type="file" id="excelFile" accept=".xlsx, .xls, .csv" class="hidden">
                        <span id="fileName" class="text-sm text-gray-500">No file selected</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <h3 class="font-semibold mb-2">Manual URL Entry</h3>
                    <div class="flex">
                        <input type="url" id="manualUrl" placeholder="Enter LinkedIn URL or webpage" class="flex-grow p-2 border rounded-l">
                        <button onclick="scrapeUrl()" class="bg-blue-500 text-white px-4 py-2 rounded-r hover:bg-blue-600">Scrape</button>
                    </div>
                </div>
                
                <div>
                    <h3 class="font-semibold mb-2">Results</h3>
                    <div class="bg-gray-50 p-4 rounded min-h-[200px] max-h-[400px] overflow-y-auto">
                        <table class="min-w-full excel-table">
                            <thead>
                                <tr>
                                    <th class="text-left">URL</th>
                                    <th class="text-left">Email</th>
                                    <th class="text-left">Name</th>
                                    <th class="text-left">Status</th>
                                </tr>
                            </thead>
                            <tbody id="scrapingResults">
                                <tr>
                                    <td colspan="4" class="text-center text-gray-500 p-4">Results will appear here</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="flex justify-end mt-4 space-x-2">
                        <button id="exportCsv" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                            <i class="bi bi-file-earmark-spreadsheet"></i> Export CSV
                        </button>
                        <button id="clearResults" class="bg-gray-300 px-4 py-2 rounded hover:bg-gray-400">
                            <i class="bi bi-trash"></i> Clear Results
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="employeeDashboard" class="hidden">
        <nav class="bg-green-600 text-white p-4">
            <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
                <h1 class="text-xl font-bold">Employee Dashboard</h1>
                <div class="flex items-center space-x-4 mt-2 md:mt-0">
                    <span id="employeeNameDisplay" class="font-medium"></span>
                    <div class="relative">
                        <button onclick="toggleEmployeeNotifications()" class="bg-green-700 px-3 py-1 rounded hover:bg-green-800">
                            <i class="bi bi-bell"></i>
                            <span id="employeeNotificationBadge" class="notification-badge hidden">0</span>
                        </button>
                        <div id="employeeNotificationsDropdown" class="hidden absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-10">
                            <div class="p-3 border-b">
                                <h3 class="text-gray-700 font-semibold">Notifications</h3>
                            </div>
                            <div id="employeeNotificationsList" class="max-h-64 overflow-y-auto p-2">
                                <!-- Notifications will be added here -->
                                <p class="text-gray-500 text-sm p-2">No new notifications</p>
                            </div>
                        </div>
                    </div>
                    <button onclick="logout()" class="bg-red-500 px-4 py-1 rounded hover:bg-red-600">Logout</button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto p-6">
            <div class="mb-6 bg-white p-4 rounded-lg shadow">
                <h2 class="text-xl font-bold mb-2">My Tasks</h2>
                <div class="flex space-x-2 mb-4">
                    <button onclick="filterEmployeeTasks('all')" class="px-3 py-1 bg-blue-500 text-white rounded">All</button>
                    <button onclick="filterEmployeeTasks('pending')" class="px-3 py-1 bg-gray-200 rounded">Pending</button>
                    <button onclick="filterEmployeeTasks('in-progress')" class="px-3 py-1 bg-gray-200 rounded">In Progress</button>
                    <button onclick="filterEmployeeTasks('completed')" class="px-3 py-1 bg-gray-200 rounded">Completed</button>
                </div>
                <div id="employeeTasks" class="grid md:grid-cols-3 gap-6">
                    <!-- Employee tasks will be dynamically added here -->
                    <p class="text-gray-500 col-span-3 text-center p-4">No tasks assigned yet</p>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h2 class="text-xl font-bold mb-2">Today's Schedule</h2>
                    <div id="todaySchedule" class="space-y-2">
                        <!-- Today's schedule will be dynamically added here -->
                        <p class="text-gray-500 text-center p-4">No tasks scheduled for today</p>
                    </div>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow">
                    <h2 class="text-xl font-bold mb-2">Performance</h2>
                    <div class="space-y-4">
                        <div>
                            <h3 class="font-semibold mb-1">Task Completion Rate</h3>
                            <div class="w-full bg-gray-200 rounded-full h-2.5">
                                <div id="completionRate" class="bg-green-600 h-2.5 rounded-full" style="width: 0%"></div>
                            </div>
                            <p class="text-sm text-gray-600 mt-1"><span id="completionRateText">0%</span> tasks completed on time</p>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold mb-1">Hours Allocation</h3>
                            <div class="flex justify-between text-sm">
                                <p>Assigned: <span id="totalHours">0</span> hours</p>
                                <p>Completed: <span id="completedHours">0</span> hours</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize localStorage if first time use
        if (!localStorage.getItem('taskManagementUsers')) {
            // Default admin user
            const defaultUsers = {
                'admin@task.com': { password: 'Byebye@123', role: 'admin', name: 'Admin User' }
            };
            localStorage.setItem('taskManagementUsers', JSON.stringify(defaultUsers));
        }

        if (!localStorage.getItem('taskManagementEmployees')) {
            const defaultEmployees = [
                { id: 'emp1', name: 'John Doe', email: 'john@example.com', password: 'pass123', position: 'Developer' },
                { id: 'emp2', name: 'Jane Smith', email: 'jane@example.com', password: 'pass123', position: 'Designer' },
                { id: 'emp3', name: 'Mike Johnson', email: 'mike@example.com', password: 'pass123', position: 'Project Manager' }
            ];
            localStorage.setItem('taskManagementEmployees', JSON.stringify(defaultEmployees));
            
            // Add employees to users
            const users = JSON.parse(localStorage.getItem('taskManagementUsers'));
            defaultEmployees.forEach(emp => {
                users[emp.email] = { password: emp.password, role: 'employee', name: emp.name, id: emp.id };
            });
            localStorage.setItem('taskManagementUsers', JSON.stringify(users));
        }

        if (!localStorage.getItem('taskManagementTasks')) {
            const defaultTasks = [
                {
                    id: 1,
                    employee: 'emp1',
                    title: 'Create homepage design',
                    description: 'Design the homepage layout for the new website',
                    hours: 8,
                    deadline: '2023-06-15T17:00',
                    frequency: 'once',
                    priority: 'high',
                    status: 'completed',
                    createdAt: '2023-06-10T10:00'
                },
                {
                    id: 2,
                    employee: 'emp2',
                    title: 'Fix login bug',
                    description: 'Debug and fix the login issue on the mobile app',
                    hours: 4,
                    deadline: '2023-06-20T12:00',
                    frequency: 'once',
                    priority: 'urgent',
                    status: 'in-progress',
                    createdAt: '2023-06-12T14:00'
                },
                {
                    id: 3,
                    employee: 'emp3',
                    title: 'Weekly team meeting',
                    description: 'Conduct weekly team meeting to discuss project progress',
                    hours: 1,
                    deadline: '2023-06-16T10:00',
                    frequency: 'weekly',
                    priority: 'medium',
                    status: 'pending',
                    createdAt: '2023-06-13T09:00'
                }
            ];
            localStorage.setItem('taskManagementTasks', JSON.stringify(defaultTasks));
        }

        if (!localStorage.getItem('taskManagementNotifications')) {
            localStorage.setItem('taskManagementNotifications', JSON.stringify([]));
        }

        // Get data from localStorage
        let users = JSON.parse(localStorage.getItem('taskManagementUsers'));
        let employees = JSON.parse(localStorage.getItem('taskManagementEmployees'));
        let tasks = JSON.parse(localStorage.getItem('taskManagementTasks'));
        let notifications = JSON.parse(localStorage.getItem('taskManagementNotifications'));
        
        let currentUser = null;
        // Check if user was logged in
        if (localStorage.getItem('currentUser')) {
            currentUser = JSON.parse(localStorage.getItem('currentUser'));
            showDashboard();
        }
        
        let editingTaskId = null;

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            
            // Task form
            document.getElementById('taskForm').addEventListener('submit', handleTaskSubmission);
            
            // New employee form
            document.getElementById('newEmployeeForm').addEventListener('submit', handleNewEmployee);
            
            // Excel file upload
            document.getElementById('excelFile').addEventListener('change', handleFileUpload);
            
            // Export button
            document.getElementById('exportCsv').addEventListener('click', exportToCsv);
            
            // Clear results button
            document.getElementById('clearResults').addEventListener('click', clearScrapingResults);

            // Status filter
            document.getElementById('statusFilter').addEventListener('change', filterTasks);
            
            // Employee filter
            document.getElementById('employeeFilter').addEventListener('change', filterTasks);
            
            // Populate employee dropdowns if user is logged in
            if (currentUser) {
                populateEmployeeDropdowns();
            }
        });

        function showDashboard() {
            document.getElementById('loginSection').classList.add('hidden');
            
            if (currentUser.role === 'admin') {
                document.getElementById('adminDashboard').classList.remove('hidden');
                showAdminSection('taskManagement');
                updateTaskList();
                updateEmployeeTable();
                populateEmployeeDropdowns();
                updateAdminNotifications();
            } else {
                document.getElementById('employeeDashboard').classList.remove('hidden');
                document.getElementById('employeeNameDisplay').textContent = currentUser.name;
                displayEmployeeTasks();
                updateEmployeePerformance();
                updateEmployeeNotifications(currentUser.email);
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (users[email] && users[email].password === password) {
                currentUser = { email, ...users[email] };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showDashboard();
            } else {
                alert('Invalid credentials!');
            }
        }

        function handleTaskSubmission(e) {
            e.preventDefault();
            const taskData = {
                employee: document.getElementById('employee').value,
                title: document.getElementById('taskTitle').value,
                description: document.getElementById('taskDesc').value,
                hours: parseInt(document.getElementById('hours').value),
                deadline: document.getElementById('deadline').value,
                frequency: document.getElementById('frequency').value,
                priority: document.getElementById('priority').value,
                sendReminder: document.getElementById('sendReminder').checked
            };
            
            if (editingTaskId) {
                // Update existing task
                const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
                if (taskIndex !== -1) {
                    const updatedTask = {
                        ...tasks[taskIndex],
                        ...taskData
                    };
                    tasks[taskIndex] = updatedTask;
                    localStorage.setItem('taskManagementTasks', JSON.stringify(tasks));
                    
                    alert('Task updated successfully!');
                    editingTaskId = null;
                }
            } else {
                // Create new task
                const task = {
                    id: Date.now(),
                    status: 'pending',
                    createdAt: new Date().toISOString(),
                    ...taskData
                };
                
                tasks.push(task);
                localStorage.setItem('taskManagementTasks', JSON.stringify(tasks));
                
                // Add notification for the employee
                const assignedEmployee = employees.find(emp => emp.id === task.employee);
                if (assignedEmployee) {
                    notifications.push({
                        id: Date.now(),
                        user: assignedEmployee.email,
                        message: `New task assigned: ${task.title}`,
                        timestamp: new Date().toISOString(),
                        read: false
                    });
                    
                    localStorage.setItem('taskManagementNotifications', JSON.stringify(notifications));
                    updateEmployeeNotifications(assignedEmployee.email);
                }
                
                alert('Task assigned successfully!');
            }
            
            updateTaskList();
            updateEmployeeTable(); // Update employee table to reflect new task
            document.getElementById('taskForm').reset();
        }

        function handleNewEmployee(e) {
            e.preventDefault();
            
            const name = document.getElementById('empName').value;
            const email = document.getElementById('empEmail').value;
            const password = document.getElementById('empPassword').value;
            const position = document.getElementById('empPosition').value;
            const editingId = document.getElementById('editingEmpId').value;
            
            // Check if email already exists (only for new employees)
            if (!editingId && users[email]) {
                alert('An employee with this email already exists!');
                return;
            }
            
            if (editingId) {
                // Update existing employee
                const index = employees.findIndex(emp => emp.id === editingId);
                if (index !== -1) {
                    // Save old email to update user entry
                    const oldEmail = employees[index].email;
                    
                    // Update employee data
                    employees[index] = {
                        id: editingId,
                        name,
                        email,
                        password,
                        position
                    };
                    
                    // Remove old email from users
                    if (oldEmail !== email) {
                        delete users[oldEmail];
                    }
                    
                    // Add updated email to users
                    users[email] = { 
                        password, 
                        role: 'employee', 
                        name, 
                        id: editingId 
                    };
                    
                    localStorage.setItem('taskManagementEmployees', JSON.stringify(employees));
                    localStorage.setItem('taskManagementUsers', JSON.stringify(users));
                    
                    alert('Employee updated successfully!');
                }
            } else {
                // Add new employee
                const newId = 'emp' + (employees.length + 1) + '_' + Date.now().toString().slice(-4);
                const newEmployee = {
                    id: newId,
                    name,
                    email,
                    password,
                    position
                };
                
                // Add to employees array
                employees.push(newEmployee);
                
                // Add to users object
                users[email] = { 
                    password, 
                    role: 'employee', 
                    name, 
                    id: newId 
                };
                
                localStorage.setItem('taskManagementEmployees', JSON.stringify(employees));
                localStorage.setItem('taskManagementUsers', JSON.stringify(users));
                
                alert('Employee added successfully!');
            }
            
            // Reset form and hidden input
            document.getElementById('editingEmpId').value = '';
            document.getElementById('saveEmployeeBtn').textContent = 'Add Employee';
            e.target.reset();
            
            // Update UI
            updateEmployeeTable();
            populateEmployeeDropdowns();
            toggleAddEmployeeForm(false);
        }

        function populateEmployeeDropdowns() {
            // Populate employee selection in task form
            const employeeSelect = document.getElementById('employee');
            employeeSelect.innerHTML = '<option value="">Select an employee</option>';
            
            // Populate employee filter
            const employeeFilter = document.getElementById('employeeFilter');
            employeeFilter.innerHTML = '<option value="all">All Employees</option>';
            
            employees.forEach(emp => {
                // Add to task assignment dropdown
                const option = document.createElement('option');
                option.value = emp.id;
                option.textContent = emp.name;
                employeeSelect.appendChild(option);
                
                // Add to filter dropdown
                const filterOption = document.createElement('option');
                filterOption.value = emp.id;
                filterOption.textContent = emp.name;
                employeeFilter.appendChild(filterOption);
            });
        }

        function updateTaskList() {
            const taskList = document.getElementById('taskList');
            const statusFilter = document.getElementById('statusFilter').value;
            const employeeFilter = document.getElementById('employeeFilter').value;
            
            let filteredTasks = tasks;
            
            // Apply filters
            if (statusFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
            }
            
            if (employeeFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.employee === employeeFilter);
            }
            
            if (filteredTasks.length === 0) {
                taskList.innerHTML = '<p class="text-center text-gray-500 p-4">No tasks matching the selected filters</p>';
                return;
            }
            
            taskList.innerHTML = '';
            
            filteredTasks.forEach(task => {
                const assignedEmployee = employees.find(emp => emp.id === task.employee);
                const employeeName = assignedEmployee ? assignedEmployee.name : 'Unknown';
                
                const deadlineDate = new Date(task.deadline);
                const isOverdue = deadlineDate < new Date() && task.status !== 'completed';
                
                const priorityColors = {
                    low: 'bg-green-100 text-green-800',
                    medium: 'bg-blue-100 text-blue-800',
                    high: 'bg-orange-100 text-orange-800',
                    urgent: 'bg-red-100 text-red-800'
                };
                
                const statusColors = {
                    'pending': 'bg-yellow-100 text-yellow-800',
                    'in-progress': 'bg-blue-100 text-blue-800',
                    'completed': 'bg-green-100 text-green-800',
                    'overdue': 'bg-red-100 text-red-800'
                };
                
                const taskElement = document.createElement('div');
                taskElement.className = `task-card ${isOverdue ? 'border-red-500 border' : ''} bg-white p-4 rounded shadow`;
                taskElement.innerHTML = `
                    <div class="flex justify-between items-start">
                        <h3 class="font-bold text-lg">${task.title}</h3>
                        <div>
                            <span class="px-2 py-1 rounded text-xs ${priorityColors[task.priority]}">${task.priority}</span>
                            <span class="px-2 py-1 rounded text-xs ml-1 ${statusColors[isOverdue ? 'overdue' : task.status]}">
                                ${isOverdue ? 'Overdue' : task.status}
                            </span>
                        </div>
                    </div>
                    <p class="mt-2">${task.description}</p>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                        <p class="text-gray-600"><i class="bi bi-person"></i> ${employeeName}</p>
                        <p class="text-gray-600"><i class="bi bi-clock"></i> ${task.hours} hours</p>
                        <p class="text-gray-600"><i class="bi bi-calendar"></i> ${new Date(task.deadline).toLocaleString()}</p>
                        <p class="text-gray-600"><i class="bi bi-arrow-repeat"></i> ${task.frequency}</p>
                    </div>
                    <div class="mt-3 flex justify-end space-x-2">
                        <button onclick="editTask(${task.id})" class="text-blue-500 hover:text-blue-700">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button onclick="deleteTask(${task.id})" class="text-red-500 hover:text-red-700">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                `;
                taskList.appendChild(taskElement);
            });
        }

        function updateEmployeeTable() {
            const tableBody = document.getElementById('employeeTableBody');
            tableBody.innerHTML = '';
            
            employees.forEach(emp => {
                // Calculate statistics
                const empTasks = tasks.filter(task => task.employee === emp.id);
                const completedTasks = empTasks.filter(task => task.status === 'completed');
                const completionRate = empTasks.length > 0 ? Math.round((completedTasks.length / empTasks.length) * 100) : 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2 px-4">${emp.name}</td>
                    <td class="py-2 px-4">${emp.email}</td>
                    <td class="py-2 px-4">${emp.position}</td>
                    <td class="py-2 px-4">${empTasks.length} (${completedTasks.length} completed)</td>
                    <td class="py-2 px-4">
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div class="bg-green-600 h-2.5 rounded-full" style="width: ${completionRate}%"></div>
                        </div>
                        <span class="text-sm">${completionRate}%</span>
                    </td>
                    <td class="py-2 px-4">
                        <button onclick="editEmployee('${emp.id}')" class="text-blue-500 hover:text-blue-700 mr-2">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button onclick="deleteEmployee('${emp.id}')" class="text-red-500 hover:text-red-700">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function displayEmployeeTasks(filter = 'all') {
            const employeeTasks = document.getElementById('employeeTasks');
            const todaySchedule = document.getElementById('todaySchedule');
            employeeTasks.innerHTML = '';
            todaySchedule.innerHTML = '';
            
            // Get current employee ID
            const userID = currentUser.id;
            
            // Filter tasks for this employee
            let userTasks = tasks.filter(task => task.employee === userID);
            
            // Apply status filter if specified
            if (filter !== 'all') {
                userTasks = userTasks.filter(task => task.status === filter);
            }
            
            // Update filter button styling
            const filterButtons = document.querySelectorAll('[onclick^="filterEmployeeTasks"]');
            filterButtons.forEach(button => {
                button.classList.remove('bg-blue-500', 'text-white');
                button.classList.add('bg-gray-200');
            });
            
            document.querySelector(`[onclick="filterEmployeeTasks('${filter}')"]`).classList.remove('bg-gray-200');
            document.querySelector(`[onclick="filterEmployeeTasks('${filter}')"]`).classList.add('bg-blue-500', 'text-white');
            
            // Check if there are any tasks
            if (userTasks.length === 0) {
                employeeTasks.innerHTML = '<p class="text-gray-500 col-span-3 text-center p-4">No tasks matching the selected filter</p>';
            } else {
                // Sort tasks by deadline
                userTasks.sort((a, b) => new Date(a.deadline) - new Date(b.deadline));
                
                userTasks.forEach(task => {
                    const deadlineDate = new Date(task.deadline);
                    const isOverdue = deadlineDate < new Date() && task.status !== 'completed';
                    
                    const priorityColors = {
                        low: 'bg-green-100 text-green-800',
                        medium: 'bg-blue-100 text-blue-800',
                        high: 'bg-orange-100 text-orange-800',
                        urgent: 'bg-red-100 text-red-800'
                    };
                    
                    const statusColors = {
                        'pending': 'bg-yellow-100 text-yellow-800',
                        'in-progress': 'bg-blue-100 text-blue-800',
                        'completed': 'bg-green-100 text-green-800',
                        'overdue': 'bg-red-100 text-red-800'
                    };
                    
                    const taskElement = document.createElement('div');
                    taskElement.className = `task-card ${isOverdue ? 'border-red-500 border' : ''} bg-white p-4 rounded shadow`;
                    taskElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h3 class="font-bold text-lg">${task.title}</h3>
                            <div>
                                <span class="px-2 py-1 rounded text-xs ${priorityColors[task.priority]}">${task.priority}</span>
                                <span class="px-2 py-1 rounded text-xs ml-1 ${statusColors[isOverdue ? 'overdue' : task.status]}">
                                    ${isOverdue ? 'Overdue' : task.status}
                                </span>
                            </div>
                        </div>
                        <p class="mt-2">${task.description}</p>
                        <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                            <p class="text-gray-600"><i class="bi bi-clock"></i> ${task.hours} hours</p>
                            <p class="text-gray-600"><i class="bi bi-calendar"></i> ${new Date(task.deadline).toLocaleString()}</p>
                            <p class="text-gray-600"><i class="bi bi-arrow-repeat"></i> ${task.frequency}</p>
                        </div>
                        <div class="mt-3 flex space-x-2">
                            ${task.status !== 'completed' ? `
                                ${task.status === 'pending' ? 
                                    `<button onclick="startTask(${task.id})" class="bg-blue-500 text-white px-3 py-1 rounded hover:bg-blue-600">
                                        Start
                                    </button>` : ''
                                }
                                ${task.status === 'in-progress' ? 
                                    `<button onclick="completeTask(${task.id})" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600">
                                        Complete
                                    </button>` : ''
                                }
                            ` : `
                                <span class="text-green-500"><i class="bi bi-check-circle"></i> Completed</span>
                            `}
                        </div>
                    `;
                    employeeTasks.appendChild(taskElement);
                    
                    // Add to today's schedule if deadline is today
                    const today = new Date();
                    if (deadlineDate.toDateString() === today.toDateString()) {
                        const scheduleItem = document.createElement('div');
                        scheduleItem.className = `p-2 ${isOverdue ? 'bg-red-50' : 'bg-blue-50'} rounded mb-2`;
                        scheduleItem.innerHTML = `
                            <div class="flex justify-between items-center">
                                <span class="font-medium">${task.title}</span>
                                <span class="text-sm">${deadlineDate.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                            </div>
                            <p class="text-sm text-gray-600">${task.description.substring(0, 60)}${task.description.length > 60 ? '...' : ''}</p>
                        `;
                        todaySchedule.appendChild(scheduleItem);
                    }
                });
            }
            
            // If no tasks for today
            if (!todaySchedule.hasChildNodes()) {
                todaySchedule.innerHTML = '<p class="text-gray-500 text-center p-4">No tasks scheduled for today</p>';
            }
        }

        function updateEmployeePerformance() {
            // Get current employee ID
            const userID = currentUser.id;
            
            // Filter tasks for this employee
            const userTasks = tasks.filter(task => task.employee === userID);
            const completedTasks = userTasks.filter(task => task.status === 'completed');
            
            // Calculate performance metrics
            const completionRate = userTasks.length > 0 ? (completedTasks.length / userTasks.length) * 100 : 0;
            const totalHours = userTasks.reduce((sum, task) => sum + parseInt(task.hours), 0);
            const completedHours = completedTasks.reduce((sum, task) => sum + parseInt(task.hours), 0);
            
            // Update UI
            document.getElementById('completionRate').style.width = `${completionRate}%`;
            document.getElementById('completionRateText').textContent = `${Math.round(completionRate)}%`;
            document.getElementById('totalHours').textContent = totalHours;
            document.getElementById('completedHours').textContent = completedHours;
        }

        function startTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'in-progress';
                
                // Save to localStorage
                localStorage.setItem('taskManagementTasks', JSON.stringify(tasks));
                
                displayEmployeeTasks('all');
                updateEmployeePerformance();
                
                // Add to notifications for admin
                notifications.push({
                    id: Date.now(),
                    user: 'admin@task.com',
                    message: `${currentUser.name} started task: ${task.title}`,
                    timestamp: new Date().toISOString(),
                    read: false
                });
                
                localStorage.setItem('taskManagementNotifications', JSON.stringify(notifications));
                updateAdminNotifications();
            }
        }

        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'completed';
                task.completedAt = new Date().toISOString();
                
                // Save to localStorage
                localStorage.setItem('taskManagementTasks', JSON.stringify(tasks));
                
                displayEmployeeTasks('all');
                updateEmployeePerformance();
                
                // Add to notifications for admin
                notifications.push({
                    id: Date.now(),
                    user: 'admin@task.com',
                    message: `${currentUser.name} completed task: ${task.title}`,
                    timestamp: new Date().toISOString(),
                    read: false
                });
                
                localStorage.setItem('taskManagementNotifications', JSON.stringify(notifications));
                updateAdminNotifications();
            }
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            // Set the editing task ID
            editingTaskId = taskId;
            
            // Populate the form with task data
            document.getElementById('employee').value = task.employee;
            document.getElementById('taskTitle').value = task.title;
            document.getElementById('taskDesc').value = task.description;
            document.getElementById('hours').value = task.hours;
            document.getElementById('deadline').value = task.deadline;
            document.getElementById('frequency').value = task.frequency;
            document.getElementById('priority').value = task.priority;
            document.getElementById('sendReminder').checked = task.sendReminder || false;
            
            // Scroll to the form
            document.getElementById('taskForm').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== taskId);
                localStorage.setItem('taskManagementTasks', JSON.stringify(tasks));
                
                updateTaskList();
                // Also update employee table to reflect task changes
                updateEmployeeTable();
            }
        }

        function editEmployee(empId) {
            const employee = employees.find(emp => emp.id === empId);
            if (!employee) return;
            
            toggleAddEmployeeForm(true);
            
            // Set editing employee ID
            document.getElementById('editingEmpId').value = empId;
            
            // Populate the form with employee data
            document.getElementById('empName').value = employee.name;
            document.getElementById('empEmail').value = employee.email;
            document.getElementById('empPassword').value = employee.password;
            document.getElementById('empPosition').value = employee.position;
            
            // Change submit button text
            document.getElementById('saveEmployeeBtn').textContent = "Update Employee";
        }

        function deleteEmployee(empId) {
            if (confirm('Are you sure you want to delete this employee?')) {
                const employeeToRemove = employees.find(emp => emp.id === empId);
                
                if (employeeToRemove) {
                    // Check if employee has tasks
                    const empTasks = tasks.filter(task => task.employee === empId);
                    
                    if (empTasks.length > 0) {
                        if (confirm(`This employee has ${empTasks.length} assigned tasks. Delete the employee and their tasks?`)) {
                            // Remove tasks assigned to this employee
                            tasks = tasks.filter(task => task.employee !== empId);
                            localStorage.setItem('taskManagementTasks', JSON.stringify(tasks));
                            
                            // Remove employee from employees array
                            employees = employees.filter(emp => emp.id !== empId);
                            
                            // Remove from users object
                            delete users[employeeToRemove.email];
                            
                            localStorage.setItem('taskManagementEmployees', JSON.stringify(employees));
                            localStorage.setItem('taskManagementUsers', JSON.stringify(users));
                            
                            alert('Employee and their tasks deleted successfully.');
                        } else {
                            return; // Cancel deletion
                        }
                    } else {
                        // No tasks, just remove the employee
                        employees = employees.filter(emp => emp.id !== empId);
                        
                        // Remove from users object
                        delete users[employeeToRemove.email];
                        
                        localStorage.setItem('taskManagementEmployees', JSON.stringify(employees));
                        localStorage.setItem('taskManagementUsers', JSON.stringify(users));
                        
                        alert('Employee deleted successfully.');
                    }
                    
                    // Update UI
                    updateEmployeeTable();
                    populateEmployeeDropdowns();
                    updateTaskList();
                }
            }
        }

        function toggleAddEmployeeForm(show) {
            const form = document.getElementById('addEmployeeForm');
            if (show === true) {
                form.classList.remove('hidden');
            } else if (show === false) {
                form.classList.add('hidden');
                // Reset form when hiding
                document.getElementById('newEmployeeForm').reset();
                document.getElementById('editingEmpId').value = '';
                // Reset button text
                document.getElementById('saveEmployeeBtn').textContent = "Add Employee";
            } else {
                form.classList.toggle('hidden');
                if (form.classList.contains('hidden')) {
                    // Reset form when toggling to hidden
                    document.getElementById('newEmployeeForm').reset();
                    document.getElementById('editingEmpId').value = '';
                    // Reset button text
                    document.getElementById('saveEmployeeBtn').textContent = "Add Employee";
                }
            }
        }

        function showAdminSection(sectionId) {
            // Hide all sections
            document.getElementById('taskManagementSection').classList.add('hidden');
            document.getElementById('employeeListSection').classList.add('hidden');
            document.getElementById('emailScraperSection').classList.add('hidden');
            
            // Show the selected section
            document.getElementById(sectionId + 'Section').classList.remove('hidden');
            
            // Update UI for the active section
            if (sectionId === 'taskManagement') {
                updateTaskList();
            } else if (sectionId === 'employeeList') {
                updateEmployeeTable();
            }
        }

        function filterTasks() {
            updateTaskList();
        }

        function filterEmployeeTasks(filter) {
            displayEmployeeTasks(filter);
        }

        function toggleNotifications() {
            const dropdown = document.getElementById('notificationsDropdown');
            dropdown.classList.toggle('hidden');
            
            if (!dropdown.classList.contains('hidden')) {
                // Update notifications list
                updateNotificationsList('admin@task.com', 'notificationsList');
            }
        }

        function toggleEmployeeNotifications() {
            const dropdown = document.getElementById('employeeNotificationsDropdown');
            dropdown.classList.toggle('hidden');
            
            if (!dropdown.classList.contains('hidden')) {
                // Update notifications list
                updateNotificationsList(currentUser.email, 'employeeNotificationsList');
            }
        }

        function updateNotificationsList(userEmail, listId) {
            const notificationsList = document.getElementById(listId);
            const userNotifications = notifications.filter(n => n.user === userEmail);
            
            if (userNotifications.length === 0) {
                notificationsList.innerHTML = '<p class="text-gray-500 text-sm p-2">No new notifications</p>';
                return;
            }
            
            notificationsList.innerHTML = '';
            userNotifications.forEach(notification => {
                const notificationElement = document.createElement('div');
                notificationElement.className = `p-2 ${notification.read ? 'bg-gray-50' : 'bg-blue-50'} border-b`;
                notificationElement.innerHTML = `
                    <div class="flex justify-between">
                        <p class="${notification.read ? 'text-gray-600' : 'text-gray-800 font-semibold'}">${notification.message}</p>
                        <button onclick="markNotificationAsRead(${notification.id})" class="text-xs text-blue-500">
                            ${notification.read ? '' : 'Mark read'}
                        </button>
                    </div>
                    <p class="text-xs text-gray-500">${new Date(notification.timestamp).toLocaleString()}</p>
                `;
                notificationsList.appendChild(notificationElement);
            });
            
            // Update badge
            const unreadCount = userNotifications.filter(n => !n.read).length;
            const badgeId = listId === 'notificationsList' ? 'notificationBadge' : 'employeeNotificationBadge';
            const badge = document.getElementById(badgeId);
            
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        function updateAdminNotifications() {
            // Update notification badge for admin user
            const adminNotifications = notifications.filter(n => n.user === 'admin@task.com' && !n.read);
            const badge = document.getElementById('notificationBadge');
            
            if (adminNotifications.length > 0 && badge) {
                badge.textContent = adminNotifications.length;
                badge.classList.remove('hidden');
            } else if (badge) {
                badge.classList.add('hidden');
            }
        }

        function updateEmployeeNotifications(email) {
            if (!email) return;
            
            // If this is the current user, update their notification badge
            if (currentUser && currentUser.email === email) {
                const employeeNotifications = notifications.filter(n => n.user === email && !n.read);
                const badge = document.getElementById('employeeNotificationBadge');
                
                if (badge && employeeNotifications.length > 0) {
                    badge.textContent = employeeNotifications.length;
                    badge.classList.remove('hidden');
                } else if (badge) {
                    badge.classList.add('hidden');
                }
            }
        }

        function markNotificationAsRead(notificationId) {
            const notificationIndex = notifications.findIndex(n => n.id === notificationId);
            if (notificationIndex !== -1) {
                notifications[notificationIndex].read = true;
                localStorage.setItem('taskManagementNotifications', JSON.stringify(notifications));
                
                // Update the list
                const listId = notifications[notificationIndex].user === 'admin@task.com' ? 'notificationsList' : 'employeeNotificationsList';
                updateNotificationsList(notifications[notificationIndex].user, listId);
            }
        }

        function handleFileUpload(e) {
            const fileName = e.target.files[0]?.name || "No file selected";
            document.getElementById('fileName').textContent = fileName;
            
            // In a real implementation, you would use a library like SheetJS to parse the Excel file
            // For this prototype, we'll simulate success
            if (e.target.files.length > 0) {
                setTimeout(() => {
                    alert('File uploaded! In a real implementation, this would process the Excel file to extract emails.');
                }, 1000);
            }
        }

        function scrapeUrl() {
            const url = document.getElementById('manualUrl').value;
            if (!url) {
                alert('Please enter a URL');
                return;
            }
            
            // In a real implementation, this would call a backend service to scrape the URL
            // For this prototype, we'll simulate success with random data
            const resultsTable = document.getElementById('scrapingResults');
            
            // Clear any "no results" message
            if (resultsTable.innerHTML.includes('Results will appear here')) {
                resultsTable.innerHTML = '';
            }
            
            // Add a loading row
            const loadingRow = document.createElement('tr');
            loadingRow.id = 'loadingRow';
            loadingRow.innerHTML = `
                <td colspan="4" class="text-center p-4">
                    <div class="flex justify-center">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"></div>
                    </div>
                    <p class="mt-2">Scraping URL...</p>
                </td>
            `;
            resultsTable.appendChild(loadingRow);
            
            // Simulate API call delay
            setTimeout(() => {
                // Remove loading row
                document.getElementById('loadingRow').remove();
                
                // Generate a fake email or show error
                const success = Math.random() > 0.3; // 70% success rate
                const row = document.createElement('tr');
                
                if (success) {
                    const domain = url.includes('linkedin.com') ? 'linkedin' : 'example';
                    const randomName = ['john.doe', 'jane.smith', 'mike.johnson', 'sarah.williams'][Math.floor(Math.random() * 4)];
                    const randomEmail = `${randomName}@${domain}.com`;
                    const name = randomName.split('.').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                    
                    row.innerHTML = `
                        <td class="p-2 border">${url}</td>
                        <td class="p-2 border">${randomEmail}</td>
                        <td class="p-2 border">${name}</td>
                        <td class="p-2 border text-green-500">Success</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td class="p-2 border">${url}</td>
                        <td class="p-2 border">-</td>
                        <td class="p-2 border">-</td>
                        <td class="p-2 border text-red-500">Failed to extract email</td>
                    `;
                }
                
                resultsTable.appendChild(row);
                document.getElementById('manualUrl').value = '';
            }, 2000);
        }

        function exportToCsv() {
            // In a real implementation, this would generate and download a CSV file
            alert('In a real implementation, this would download a CSV file of the results.');
        }

        function clearScrapingResults() {
            document.getElementById('scrapingResults').innerHTML = `
                <tr>
                    <td colspan="4" class="text-center text-gray-500 p-4">Results will appear here</td>
                </tr>
            `;
        }

        function logout() {
            localStorage.removeItem('currentUser');
            currentUser = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('employeeDashboard').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        // Check for tasks that need reminders
        setInterval(() => {
            if (!currentUser) return;
            
            const now = new Date();
            tasks.forEach(task => {
                const deadline = new Date(task.deadline);
                const timeDiff = deadline - now;
                
                // Send reminder if less than 1 hour before deadline and task is not completed
                if (task.sendReminder && task.status !== 'completed' && 
                    timeDiff > 0 && timeDiff <= 3600000) {
                    
                    // For admin, show all reminders
                    if (currentUser.role === 'admin') {
                        const employee = employees.find(emp => emp.id === task.employee);
                        const employeeName = employee ? employee.name : 'Unknown';
                        
                        alert(`Reminder: Task "${task.title}" assigned to ${employeeName} is due in less than an hour!`);
                    } 
                    // For employees, only show their own reminders
                    else if (currentUser.role === 'employee' && task.employee === currentUser.id) {
                        alert(`Reminder: Your task "${task.title}" is due in less than an hour!`);
                    }
                }
            });
        }, 300000); // Check every 5 minutes
    </script>
<script>document.body.addEventListener('wheel', e => { if (!e.ctrlKey) return; e.preventDefault(); return }, { passive: false })</script>
	</body>
</html>